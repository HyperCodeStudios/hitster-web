<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Hitster Player</title>
    <style>
        body { background: #121212; color: white; text-align: center; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; height: 100vh; margin: 0; }
        .btn { background: #1db954; color: white; padding: 20px; border-radius: 50px; font-size: 1.5rem; border: none; cursor: pointer; }
        #status { margin-top: 20px; color: #888; }
    </style>
</head>
<body>
    <h1>Bereit zum Spielen?</h1>
    <button class="btn" id="playBtn">üéµ Musik abspielen</button>
    <div id="status">Warte auf Scan...</div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const params = new URLSearchParams(window.location.search);
        const trackId = params.get('id');
        // WICHTIG: Pr√ºfen, ob der Token wirklich da ist
        const token = localStorage.getItem("spotify_token"); 

        document.getElementById('playBtn').onclick = async () => {
            if (!token) {
                console.error("Kein Token im LocalStorage gefunden!");
                alert("Bitte logge dich auf der Hauptseite ein.");
                return;
            }

            try {
                await axios({
                    method: 'put',
                    url: 'https://api.spotify.com/v1/me/player/play', // Nutze die echte URL zum Testen
                    data: { uris: [`spotify:track:${trackId}`] },
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                document.getElementById('status').textContent = "Lied l√§uft!";
            } catch (err) {
                console.error("API Fehler Details:", err.response ? err.response.data : err);
                if(err.response && err.response.status === 404) {
                    alert("Kein aktives Spotify-Ger√§t gefunden! √ñffne Spotify auf deinem Handy und spiele kurz ein Lied ab.");
                } else if(err.response && err.response.status === 403) {
                    alert("Spotify Premium erforderlich f√ºr API-Steuerung.");
                } else {
                    alert("Fehler: " + err.message);
                }
            }
        };
    </script>
</body>
</html>
